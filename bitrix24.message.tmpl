{{ define "bitrix24_subject" }}{{ if gt (len .Alerts.Firing) 0 -}}–í–Ω–∏–º–∞–Ω–∏–µ!{{ end }}{{ if gt (len .Alerts.Resolved) 0 -}}–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!{{ end }}{{ end }}
{{ define "bitrix24.message" }}
{{ if gt (len .Alerts.Firing) 0 }}
{{ range $index, $alert := .Alerts.Firing }}
{{ if eq $index 0 }}
{{ if eq $alert.Labels.severity "critical" }}[COLOR=#CC0000]üî• –í–Ω–∏–º–∞–Ω–∏–µ![/COLOR]{{ else }}[COLOR=#FF9900]‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ![/COLOR]{{ end }}
[BR][B]–¢—Ä–∏–≥–≥–µ—Ä:[/B] {{ $alert.Labels.alertname }}
[BR][B]–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:[/B] {{ $alert.Labels.severity }}
[BR][B]–û–ø–∏—Å–∞–Ω–∏–µ:[/B] {{ $alert.Annotations.description }}
{{ end }}
{{ end }}
[BR][BR][U][B]–î–µ—Ç–∞–ª–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞:[/B][/U][BR]
{{ $hasHosts := false }}{{ $hasGroups := false }}{{ $hasValuesAbs := false }}{{ $hasValuesPercent := false }}{{ $hasConsumerGroups := false }}
{{ range .Alerts.Firing }}
 {{ if .Labels.instance }}{{ $hasHosts = true }}{{ end }}
 {{ if .Labels.group }}{{ $hasGroups = true }}{{ end }}
 {{ if .Annotations.valueabsolute }}{{ $hasValuesAbs = true }}{{ end }}
 {{ if .Annotations.valuepercent }}{{ $hasValuesPercent = true }}{{ end }}
 {{ if .Labels.consumergroup }}{{ $hasConsumerGroups = true }}{{ end }}
{{ end }}

{{ if $hasHosts }}
[BR][B]–•–æ—Å—Ç:[/B]
{{ range .Alerts.Firing }}{{ if .Labels.instance }}[BR]{{ .Labels.instance }}{{ end }}{{ end }}
{{ end }}

{{ if $hasGroups }}
[BR][B]–ì—Ä—É–ø–ø–∞:[/B]
{{ range .Alerts.Firing }}{{ if .Labels.group }}[BR]{{ .Labels.group }}{{ end }}{{ end }}
{{ end }}

{{ if $hasValuesAbs }}
[BR][B]–ó–Ω–∞—á–µ–Ω–∏–µ (–∞–±—Å.):[/B]
{{ range .Alerts.Firing }}{{ if .Annotations.valueabsolute }}[BR]{{ .Annotations.valueabsolute }}{{ end }}{{ end }}
{{ end }}

{{ if $hasValuesPercent }}
[BR][B]–ó–Ω–∞—á–µ–Ω–∏–µ (%):[/B]
{{ range .Alerts.Firing }}{{ if .Annotations.valuepercent }}[BR]{{ .Annotations.valuepercent }}{{ end }}{{ end }}
{{ end }}

{{ if $hasConsumerGroups }}
[BR][B]Consumer Group:[/B]
{{ range .Alerts.Firing }}{{ if .Labels.consumergroup }}[BR]{{ .Labels.consumergroup }} (Lag: {{ .Annotations.valueabsolute }}){{ end }}{{ end }}
{{ end }}
{{ end }}

{{ if and (gt (len .Alerts.Resolved) 0) (eq (len .Alerts.Firing) 0) }}
[COLOR=#00AA00]‚úì –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞![/COLOR]
{{ range $index, $alert := .Alerts.Resolved }}{{ if eq $index 0 }}
[BR][B]–¢—Ä–∏–≥–≥–µ—Ä:[/B] {{ $alert.Labels.alertname }}
[BR][B]–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:[/B] {{ $alert.Labels.severity }}
[BR][B]–û–ø–∏—Å–∞–Ω–∏–µ:[/B] {{ $alert.Annotations.description }}
{{ end }}
{{ end }}
[BR][BR][U][B]–î–µ—Ç–∞–ª–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞:[/B][/U][BR]
{{ $hasHosts := false }}{{ $hasGroups := false }}{{ $hasValuesAbs := false }}{{ $hasValuesPercent := false }}{{ $hasConsumerGroups := false }}
{{ range .Alerts.Resolved }}
 {{ if .Labels.instance }}{{ $hasHosts = true }}{{ end }}
 {{ if .Labels.group }}{{ $hasGroups = true }}{{ end }}
 {{ if .Annotations.valueabsolute }}{{ $hasValuesAbs = true }}{{ end }}
 {{ if .Annotations.valuepercent }}{{ $hasValuesPercent = true }}{{ end }}
 {{ if .Labels.consumergroup }}{{ $hasConsumerGroups = true }}{{ end }}
{{ end }}

{{ if $hasHosts }}
[BR][B]–•–æ—Å—Ç:[/B]
{{ range .Alerts.Resolved }}{{ if .Labels.instance }}[BR]{{ .Labels.instance }}{{ end }}{{ end }}
{{ end }}

{{ if $hasGroups }}
[BR][B]–ì—Ä—É–ø–ø–∞:[/B]
{{ range .Alerts.Resolved }}{{ if .Labels.group }}[BR]{{ .Labels.group }}{{ end }}{{ end }}
{{ end }}

{{ if $hasValuesAbs }}
[BR][B]–ó–Ω–∞—á–µ–Ω–∏–µ (–∞–±—Å.):[/B]
{{ range .Alerts.Resolved }}{{ if .Annotations.valueabsolute }}[BR]{{ .Annotations.valueabsolute }}{{ end }}{{ end }}
{{ end }}

{{ if $hasValuesPercent }}
[BR][B]–ó–Ω–∞—á–µ–Ω–∏–µ (%):[/B]
{{ range .Alerts.Resolved }}{{ if .Annotations.valuepercent }}[BR]{{ .Annotations.valuepercent }}{{ end }}{{ end }}
{{ end }}

{{ if $hasConsumerGroups }}
[BR][B]Consumer Group:[/B]
{{ range .Alerts.Resolved }}{{ if .Labels.consumergroup }}[BR]{{ .Labels.consumergroup }} (Lag: {{ .Annotations.valueabsolute }}){{ end }}{{ end }}
{{ end }}
{{ end }}
{{ end }}