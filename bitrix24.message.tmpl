{{ define "bitrix24.message" }}

{{ if gt (len .Alerts.Firing) 0 }}
{{ range $index, $alert := .Alerts.Firing }}
{{ if eq $index 0 }}
{{ if eq $alert.Labels.severity "critical" }}[COLOR=#CC0000]üî• –í–Ω–∏–º–∞–Ω–∏–µ![/COLOR]{{ else }}[COLOR=#FF9900]‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ![/COLOR]{{ end }}
[BR][B]–¢—Ä–∏–≥–≥–µ—Ä:[/B] {{ $alert.Annotations.summary }}
[BR][B]–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:[/B] {{ $alert.Labels.severity }}
[BR][B]–û–ø–∏—Å–∞–Ω–∏–µ:[/B] {{ $alert.Annotations.description }}
{{ if $alert.Labels.job }}
[BR][B]Job:[/B] {{ $alert.Labels.job }}
{{ end }}
{{ end }}
{{ end }}

{{ $hasDetails := false }}
{{ $hasHosts := false }}{{ $hasGroups := false }}{{ $hasConsumerGroups := false }}{{ $hasValues := false }}

{{ range .Alerts.Firing }}
 {{ if .Labels.instance }}{{ $hasHosts = true }}{{ $hasDetails = true }}{{ end }}
 {{ if .Labels.group }}{{ $hasGroups = true }}{{ $hasDetails = true }}{{ end }}
 {{ if .Labels.consumergroup }}{{ $hasConsumerGroups = true }}{{ $hasDetails = true }}{{ end }}
 {{ if .Annotations.valueabsolute }}{{ $hasValues = true }}{{ $hasDetails = true }}{{ end }}
{{ end }}

{{ if $hasDetails }}
[BR][BR][U][B]–î–µ—Ç–∞–ª–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞:[/B][/U][BR]

{{ if $hasHosts }}
[BR][B]–•–æ—Å—Ç:[/B]
{{ range .Alerts.Firing }}{{ if .Labels.instance }}[BR]{{ .Labels.instance }} (–ó–Ω–∞—á–µ–Ω–∏–µ: {{ .Annotations.value }}){{ end }}{{ end }}
{{ end }}

{{ if $hasGroups }}
[BR][B]–ì—Ä—É–ø–ø–∞:[/B]
{{ range $index, $alert := .Alerts.Firing }}
 {{ if and (eq $index 0) $alert.Labels.group }}[BR]{{ $alert.Labels.group }}{{ end }}
{{ end }}
{{ end }}

{{ if $hasConsumerGroups }}
[BR][B]Consumer Group:[/B]
{{ range .Alerts.Firing }}{{ if .Labels.consumergroup }}
[BR]{{ .Labels.consumergroup }} (Lag: {{ .Annotations.valueabsolute }})
{{ end }}{{ end }}
{{ end }}

{{ end }}
{{ end }}

{{ if and (gt (len .Alerts.Resolved) 0) (eq (len .Alerts.Firing) 0) }}
[COLOR=#00AA00]‚úì –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞![/COLOR]

{{ range $index, $alert := .Alerts.Resolved }}{{ if eq $index 0 }}
[BR][B]–¢—Ä–∏–≥–≥–µ—Ä:[/B] {{ $alert.Annotations.summary }}
[BR][B]–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:[/B] {{ $alert.Labels.severity }}
[BR][B]–û–ø–∏—Å–∞–Ω–∏–µ:[/B] {{ $alert.Annotations.description }}
{{ if $alert.Labels.job }}
[BR][B]Job:[/B] {{ $alert.Labels.job }}
{{ end }}
{{ end }}
{{ end }}

{{ $hasDetails := false }}
{{ $hasHosts := false }}{{ $hasGroups := false }}{{ $hasConsumerGroups := false }}{{ $hasValues := false }}

{{ range .Alerts.Resolved }}
 {{ if .Labels.instance }}{{ $hasHosts = true }}{{ $hasDetails = true }}{{ end }}
 {{ if .Labels.group }}{{ $hasGroups = true }}{{ $hasDetails = true }}{{ end }}
 {{ if .Labels.consumergroup }}{{ $hasConsumerGroups = true }}{{ $hasDetails = true }}{{ end }}
 {{ if .Annotations.valueabsolute }}{{ $hasValues = true }}{{ $hasDetails = true }}{{ end }}
{{ end }}

{{ if $hasDetails }}
[BR][BR][U][B]–î–µ—Ç–∞–ª–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞:[/B][/U][BR]

{{ if $hasHosts }}
[BR][B]–•–æ—Å—Ç:[/B]
{{ range .Alerts.Resolved }}{{ if .Labels.instance }}[BR]{{ .Labels.instance }} (–ó–Ω–∞—á–µ–Ω–∏–µ: {{ .Annotations.value }}){{ end }}{{ end }}
{{ end }}

{{ if $hasGroups }}
[BR][B]–ì—Ä—É–ø–ø–∞:[/B]
{{ range $index, $alert := .Alerts.Resolved }}
 {{ if and (eq $index 0) $alert.Labels.group }}[BR]{{ $alert.Labels.group }}{{ end }}
{{ end }}
{{ end }}

{{ if $hasConsumerGroups }}
[BR][B]Consumer Group:[/B]
{{ range .Alerts.Resolved }}{{ if .Labels.consumergroup }}
[BR]{{ .Labels.consumergroup }} (Lag: {{ .Annotations.valueabsolute }})
{{ end }}{{ end }}
{{ end }}

{{ end }}
{{ end }}
{{ end }}